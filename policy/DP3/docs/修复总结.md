# DP3-EndPose æ•°æ®å¯¹é½ä¿®å¤æ€»ç»“

> **ä¿®å¤æ—¥æœŸ**: 2025å¹´12æœˆ22æ—¥  
> **ä¿®å¤æ–‡ä»¶**: `scripts/process_data_endpose.py`

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®å¤æ—¶é—´å¯¹é½é”™è¯¯

**é—®é¢˜**: actionä½¿ç”¨çš„æ˜¯å¸§jçš„æ•°æ®ï¼Œè€Œä¸æ˜¯å¸§j+1çš„æ•°æ®

**ä¿®å¤**: 
- ä¿®æ”¹actionå­˜å‚¨é€»è¾‘ï¼š`action[i] = å¸§i+1çš„åŠ¨ä½œ`
- ç¡®ä¿è§‚æµ‹å¸§[j-2, j-1, j]å¯¹åº”åŠ¨ä½œå¸§[j+1, j+2, j+3, j+4, j+5, j+6]

### 2. æ·»åŠ horizonå¡«å……é€»è¾‘

**é—®é¢˜**: actionæ•°ç»„éœ€è¦æ»¡è¶³horizon=8çš„è¦æ±‚

**ä¿®å¤**:
- æ‰©å±•actionæ•°ç»„ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„é•¿åº¦
- å¡«å……action[i+6]å’Œaction[i+7]ä¸ºå¸§i+6çš„åŠ¨ä½œï¼ˆé‡å¤æœ€åä¸€å¸§ï¼‰

### 3. æ¸…ç†æ—§æ•°æ®

**å·²å®Œæˆ**:
- âœ… åˆ é™¤æ—§çš„endposeæ•°æ®æ–‡ä»¶
- âœ… åˆ é™¤æ—§çš„è®­ç»ƒç»“æœ
- âœ… åˆ›å»ºæ¸…ç†è„šæœ¬ `scripts/clean_endpose_data.sh`

---

## ğŸ“Š æ•°æ®å¯¹é½éªŒè¯

### å¯¹é½é€»è¾‘

å¯¹äºè§‚æµ‹å¸§jï¼ˆå¯¹åº”ç´¢å¼•iï¼‰ï¼š
- **è§‚æµ‹**: [j-2, j-1, j]ï¼ˆDatasetä¼šè‡ªåŠ¨paddingå‰2å¸§ï¼‰
- **åŠ¨ä½œ**: [j+1, j+2, j+3, j+4, j+5, j+6, j+6, j+6]ï¼ˆ8å¸§ï¼Œå2å¸§é‡å¤ï¼‰

### ç‰¹æ®Šå¤„ç†

- **j=0**: è§‚æµ‹[0, 0, 0]ï¼ˆDataset paddingï¼‰ï¼ŒåŠ¨ä½œ[1, 2, 3, 4, 5, 6]
- **j=1**: è§‚æµ‹[0, 0, 1]ï¼ˆDataset paddingï¼‰ï¼ŒåŠ¨ä½œ[2, 3, 4, 5, 6, 7]
- **j>=2**: è§‚æµ‹[j-2, j-1, j]ï¼ŒåŠ¨ä½œ[j+1, j+2, j+3, j+4, j+5, j+6]

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. é‡æ–°å¤„ç†æ•°æ®

```bash
cd /mnt/4T/RoboTwin/policy/DP3
conda activate RoboTwin
bash process_data_endpose.sh stack_blocks_two demo_clean 50
```

### 2. éªŒè¯æ•°æ®æ ¼å¼

```bash
conda activate RoboTwin
python -c "
import zarr
z = zarr.open('./data/stack_blocks_two-demo_clean-50-endpose.zarr', 'r')
print('Point cloud:', z['data/point_cloud'].shape)
print('State:', z['data/state'].shape)
print('Action:', z['data/action'].shape)
print('âœ… æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡')
"
```

### 3. é‡æ–°è®­ç»ƒæ¨¡å‹

```bash
conda activate RoboTwin
bash train_endpose.sh stack_blocks_two demo_clean 50 0 0
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¯¹é½**: ç¡®ä¿ç†è§£è§‚æµ‹å¸§å’ŒåŠ¨ä½œå¸§çš„å¯¹åº”å…³ç³»
2. **Horizonå¡«å……**: actionæ•°ç»„å2å¸§æ˜¯é‡å¤çš„ï¼Œç”¨äºæ—¶åºå¹³æ»‘
3. **ç‰¹æ®Šå¤„ç†**: ç¬¬0, 1å¸§çš„è§‚æµ‹ç”±Datasetè‡ªåŠ¨paddingå¤„ç†
4. **éªŒè¯**: é‡æ–°å¤„ç†æ•°æ®åï¼ŒåŠ¡å¿…éªŒè¯æ•°æ®æ ¼å¼

---

**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ  
**æ¸…ç†çŠ¶æ€**: âœ… å®Œæˆ  
**ä¸‹ä¸€æ­¥**: é‡æ–°å¤„ç†æ•°æ®å¹¶è®­ç»ƒ

